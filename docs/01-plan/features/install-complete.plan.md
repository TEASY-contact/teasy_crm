# 시공 완료 (Install Complete) 기획서

시공 완료 양식은 시공 확정 계획에 따라 실제 현장 설치가 완료되었음을 증빙하고, 최종 투입 자재와 시공 상태를 기록하는 **'시공 프로젝트의 최종 종료 보고서'**입니다. 단순히 완료 상태를 기록하는 것을 넘어, 계획 대비 변경된 자재를 정밀 정산(Settlement)하여 재고의 무결성을 확보하고 현장 품질을 검증하는 핵심 모듈입니다.

---

## 1. 시각 표준 및 UI/UX (Visual & UX Engineering)

### 1.1 모달 시스템 및 UI 물리학 (Physics & Modals)
*   **사일런트 포커스 가드 (Focus Hijack Prevention)**: 모달 오픈 시 브라우저가 첫 번째 입력 필드에 강제 포커스를 두어 키보드를 팝업시키는 현상을 방지하기 위해, 투명한 더미 요소(`silentRef`)에 초기 포커스를 가두는 시스템 적용.
*   **UI 페인트 딜레이 (Paint Guard)**: 복잡한 재고 연산 전 UI가 "처리 중..." 상태를 확실히 렌더링할 수 있도록 **100ms의 인위적 페인트 시간**을 확보한 후 트랜잭션 수행.
*   **마이크로 리프팅 (Tactile Feedback)**: 버튼 및 인터랙티브 요소 호버 시 `cubic-bezier` 곡선을 따라 **`translateY(-1px)`** 부상하며, 클릭 시 **`scale(0.97)`**로 축소되는 물리 효과 적용.
*   **고퀄리티 스크롤바**: 내부 영역에 **4px 두께**의 반투명 커스텀 스크롤바(`rgba(0,0,0,0.08)`) 적용 및 가로 스크롤 강제 숨김.

### 1.2 입력기 인텔리전스 (Input Intelligence)
*   **TeasyDateTimeInput 슬롯 매니지먼트**:
    *   **Shift-Zero (Cursor Jump)**: 월/일 입력 시 '2' 등 단일 숫자 입력 시 '02' 패딩과 동시에 다음 슬롯으로 커서가 즉시 점프.
    *   **Forward Delete 엔진**: 구분 기호(`-`, `:`)를 건너뛰며 다음 숫자 슬롯을 소멸시키는 슬롯 기반 삭제 로직.
    *   **Hard-Range Validation**: 24시간/31일 범위를 초과하는 입력 시 해당 슬롯을 즉시 공백으로 초기화.

---

## 2. 업무 수행 및 품질 증빙 (Execution & Quality)

### 2.1 수행 결과 및 체크리스트 (Tasks & Logistics)
*   **수행불가 사유의 시각 위계**: 사유 입력창은 `red.50` 배경의 박스로 강조되며, 체크 이모지와 정렬을 맞추기 위해 **`pl: "56px"`**의 정밀 수평 오프셋 적용.
*   **원형 숫자 조판 표준 (Circled Number)**: 유니코드 `①`~`⑳`을 사용하되, 항목이 **단 1개일 경우 번호를 자동 스트리핑**하여 시각적 과잉 방지. 21번부터는 `21.` 형태의 아라비아 숫자 자동 전환(Fallback).
*   **연동형 수량 가속기**: 상위 상품 수량 변경 시 연결된 자동 자재(`isAuto: true`)들의 수량이 실시간으로 합산 재계산되어 동기화됨.

### 2.2 미디어 엔진 및 보안 (Media Engineering)
*   **파일명 조판 및 보안**:
    *   **파일명 정규화**: 파일명 내 모든 공백/특수문자를 **언더바(`_`)**로 치환하고 확장자를 `lastIndexOf('.')` 기반으로 강제 절단하여 표시.
    *   **Siloing Storage**: 모든 사진 자원은 `${customerId}` 폴더 내에 격리 저장하여 조회 성능 최적화.
*   **안전한 다운로드 브릿지**: `fetch`의 `no-cache` 모드로 데이터를 확보한 후 `Blob` 객체를 통해 다운로드를 수행하여 데이터 구식화 방지.
*   **세션 스로틀링**: 다중 파일 다운로드 시 브라우저 보안 정책 우회를 위해 파일당 **200ms의 인위적 지연(Sleep)** 발생.

---

## 3. 기능 및 비즈니스 로직 (Functionality & Logic)

### 3.1 정밀 재고 정산 및 계승 (Settlement Architecture)
*   **자가 치유 엔진 (Self-Healing)**: 재고 오차 발견 시 전체 로그를 시간순으로 재정렬하여 현재고를 전수 재연산하며, `asset_meta`와 트랜잭션 단위로 동기화.
*   **순번 계승 정책**: 신규 보고서 생성 시 마지막 '시공 확정' 스케줄의 `sequenceNumber`를 계승. 이력이 없을 경우에만 새로운 독립 차수 발행.
*   **데이터 정량 표준**: 금액 천단위 콤마(`formatAmount`) 및 연락처 숫자 정제(`replace(/[^0-9]/g, "")`) 강제 적용.

### 3.2 권한 및 보안 통제 (Authority & Safety)
*   **수정 기한의 기준점**: 3영업일 카운트다운은 유저가 선택한 일시가 아닌, **문서가 실제로 DB에 생성된 시점(`createdAt`)**을 기준으로 계산.
*   **관리자 권한 경계**:
    *   **Master**: 상시 수정 및 삭제 권한 독점.
    *   **Admin/Author**: `createdAt` 기준 3영업일 이내에만 수정 가능 (Admin도 3일 제한 적용).
*   **잠금 트리거**: 대시보드 뷰(`isDashboardView`) 또는 단순 확인 모드(`isConfirmationMode`)에서는 모든 수정 권한 강제 잠금.

---

## 4. 타임라인 표현 표준 (Timeline Identity)

*   **조판 리듬 (Visual Rhythm)**: 일시 표시 시 날짜와 시간 사이에 **'2칸 공백(`  `)'**을 강제하고, 콜론 전후에는 **비보관 공백(`\u00A0`)**을 배치하여 줄바꿈 시 콜론이 고립되는 현상 방지.
*   **브랜드 케이스**: 텍스트 내 'crm' 발견 시 렌더링 시점에 **대문자 'CRM'**으로 자동 교정.
*   **담당자 메타 위계**: 퇴사자(`banned`) 회색 처리 및 `(퇴)` 접미사 적용. 협력사(`partner`)의 경우 노란색 전용 배지 중첩 노출.

---

## 5. 버전 기록 (Version History)

| 버전 | 날짜 | 변경 사항 |
|:---|:---|:---|
| v3.0 | 2026-02-04 | 126건 최종 팩트 체크 완료. 트리플 리던던시 휴일 엔진, 스토리지 샤딩, 수량 가속기 통합 |
| v4.0 | 2026-02-04 | 10차 정밀 감사 반영. 포커스 가드, 슬롯 기반 입력기, \u00A0 콜론 조판, 56px 오프셋 및 물리 효과 사양 통합 |

---
> [!IMPORTANT]
> 본 기획서는 실제 운영 코드의 모든 로직을 라인별로 정밀 역설계하여 작성된 최종 명세입니다. 특히 사일런트 포커스 가드와 비보관 공백 조판 표준, 자가 치유 엔진은 시스템 무결성과 사용자 경험의 정점을 위한 핵심 규격이므로 철저히 준수되어야 합니다.
