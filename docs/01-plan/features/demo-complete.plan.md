# 시연 완료 (Demo Complete) 기획서

시연 완료 양식은 현장에서 진행된 시연의 결과와 고객의 반응, 그리고 구체적인 제안 사항을 기록하는 **'영업 성패의 핵심 기록'**입니다. 시각적 증빙(사진)과 파격적인 혜택 제안(할인)을 단일 화면에서 관리하도록 설계되었습니다.

---

## 1. 시각 표준 및 UI/UX (Visual & UX)

시스템 전반의 **'Teasy Premium Vibe'**와 전역 시각 표준을 준수합니다.

### 1.1 모달 디자인 상세 (Modal Design Specs)
*   **3단계 계층 구조**: 상단(일시/담당자), 중단(방문처/연락처/결과), 하단(할인 제안/사진/참고)의 논리적 섹션 분리.
*   **동적 필드 엔진 (Dynamic UX)**:
    *   **할인 방식 연동**: `discountType` 선택값에 따라 `discountValue` 필드(금액 입력 or 쿠폰 선택)가 실시간으로 스위칭됨.
    *   **수평 정렬 최적화**: 라벨 높이 차이에 관계없이 `align="flex-end"`를 적용하여 하단 라인이 정갈하게 일치하도록 설계됨.
*   **실시간 금액 포맷팅 (v124.77)**: 
    *   '현금 할인' 선택 시 금액 입력창(`handleCashInput`)에 숫자 입력 즉시 **천 단위 콤마와 마이너스(`-`)** 기호가 자동 부여됨. (예: `-100,000`)
    *   `Intl.NumberFormat`을 사용하여 화폐 포맷 준수.
*   **사진 업로드 관리**:
    *   **공간 디자인**: `gray.50` 배경과 `1px dashed` 보더를 가진 전용박스 영역 배치.
    *   **카운팅 피드백**: 필드 라벨 우측에 `(현재수/최대수)` 배지 노출 (최대 15장 / `DEMO_CONSTANTS.MAX_PHOTOS`).
*   **플레이스홀더 및 규격 (Verbatim)**:
    *   연락처는 `placeholder="000-0000-0000"`, 나머지는 선택 `placeholder="선택"`, 입력 `placeholder="입력"`.
    *   완료 일시는 **미래 시점 선택 불가** (`limitType="future"`).
    *   공통 `h="45px"`, `borderRadius="10px"` 준수.

### 1.2 타임라인 카드 UI (Timeline Representation)
*   **헤더**: '시연 완료' 배지(**Color: `purple`**), 완료 일시, 작성자 성명.
*   **정보 리스트**:
    *   **주소**: `주소 :  {location}` (TimelineCard.tsx 기준 라벨: "주소")
    *   **전화**: `전화 :  000-0000-0000`
    *   **상품**: `상품 :  {product}` (입력값이 `crm`일 경우 대문자 `CRM`으로 자동 치환 노출)
    *   **결과**: `결과 :  {result}`
    *   **제안**: `제안 :  {discountType}${content.discountValue ? ` (${content.discountValue})` : ""}`
        *   `discountType`이 "할인 없음", "할인 제안하지 않음", "해당 없음" 일 경우 단독으로 `"할인 없음"` 표기.
*   **시각 증빙**: '사진' 라벨과 함께 썸네일 그리드 노출.
*   **참고 사항**: 고유의 그레이 메모 박스(`gray.50`) 공간에 제목 '· 참고사항'과 함께 줄바꿈 포함 노출.

---

## 2. 기능 및 비즈니스 로직 (Functionality & Logic)

### 2.1 자원 관리 및 무결성 (High Integrity)
*   **사진 정밀 중복 방지 (v124.77)**: 
    *   **선택 단계**: `file.name + file.size` 조합의 고유 키를 사용하여 동일 파일 이중 등록 차단.
    *   **업로드 단계**: `Map` 객체 및 Base URL 정규화(`split('?')[0]`)를 통해 중복 업로드 방지 및 병렬 업로드 수행.
*   **리소스 정리 (Storage Physics)**:
    *   **수정 시**: 사진 교체될 경우 기존 클라우드 URL에 대해 `deleteObject` 수행 (`https://firebasestorage...` 체크 포함).
    *   **삭제 시**: 보고서 전체 삭제 시 종속된 모든 사진 파일 영구 소거.
    *   **메모리 관리**: 브라우저 메모리 상의 `blob:` URL은 `revokeObjectURL`로 즉시 소거.

### 2.2 시스템 연동 및 데이터 계승 (Integration)
*   **데이터 계승 (Inheritance)**: 
    *   신규 작성 시 가장 최근의 '시연 확정'(`demo_schedule`) 문서에서 `manager`, `location`, `phone`, `product` 자동 상속.
*   **고객 기여 (Customer Sync)**: 저장 성공 시 고객 정보의 `lastConsultDate`가 시연 완료 일시로 업데이트됨.
*   **원자적 트랜잭션**: `customer_meta` (Prefix: `{customerId}_demo`)를 통한 순번 발급.
*   **선택 옵션 (Verbatim)**:
    *   **시연 결과**: `"구매의향 높음"`, `"구매의향 보통"`, `"구매의향 낮음"`
    *   **할인 방식**: `"할인 없음"`, `"현금 할인"`, `"네이버 쿠폰"` (라벨은 "할인 쿠폰")

---

## 3. 시각 브랜드 세부 표준 (Visual Brand Standards)
*   **콜론 규격 (Verbatim Spacing)**: 모든 라벨의 콜론은 반드시 **'전 1칸, 후 2칸'** 공백 규격(` :  `)을 준수함.
*   **ThinParen 적용**: 수량(`×`), 괄호(`()`), 하이픈(`-`) 등 특수 문자는 `ThinParen` 적용.
*   **날짜 표기**: 연-월-일과 시:분 사이에 **2칸 공백** 사용. (`YYYY-MM-DD  HH:mm`)

---

## 4. 버전 기록 (Version History)

| 버전 | 날짜 | 변경 사항 |
|:---|:---|:---|
| v1.0 | 2026-02-03 | 시연 완료 기획서 초안 작성 |
| v1.1 | 2026-02-03 | 실시간 금액 포맷팅(handleCashInput) 및 사진 정밀 중복 방지 보완 |
| v1.2 | 2026-02-03 | "시연 확정" 데이터 계승(Inheritance) 및 Storage Physics 지침 추가 |

---
> [!NOTE]
> 본 문서는 '시연 완료' 모듈의 구현 기준점입니다. 사진 업로드의 안정성과 할인 제안 로직의 데이터 일관성을 위해 본 지침을 최우선으로 준수합니다.
