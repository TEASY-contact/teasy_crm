# 시공 확정 (Install Schedule) 기획서

시공 확정 양식은 실제 제품 설치를 위한 **'현장 투입 및 자재 운영'**을 설계하는 도구입니다. 시공될 상품에 필요한 각종 부자재를 자동으로 산출하고, 재고 시스템과 실시간으로 연동되어 오차 없는 시공 준비를 지원합니다.

---

## 1. 시각 표준 및 UI/UX (Visual & UX)

시스템 전반의 **'Teasy Premium Vibe'**와 고유의 리스트 레이아웃 표준을 준수합니다.

### 1.1 모달 디자인 상세 (Modal Design Specs)
*   **지능형 리스트 시스템 (Product & Supply)**:
    *   **섹션 분리**: 상품 리스트는 `gray.50`, 준비 물품(부자재) 리스트는 `purple.50` 배경 박스에 그룹화.
    *   **합산/수동 구분 (v124.77)**: 자동산출 자재와 수동 추가 항목 사이에 `purple.200` 색상의 **'Dashed Divider'** 배치.
    *   **인덱싱**: `getCircledNumber`를 통해 순번 부여.
*   **업무 지시서 디자인 (Task UX)**:
    *   시공 전/후 섹션을 `gray.50` 배경 내 `white` 카드 형태로 수직 리스트업. 
    *   `tasksBefore`, `tasksAfter` 배열로 관리되며 초기값은 `[""]`로 세팅됨.
    *   `variant="unstyled"` 필드 사용으로 텍스트 기반 정보 기재 특화.
*   **사진 계승 인터페이스**:
    *   신규 작성 시 '시연 완료'(`demo_complete`) 보고서의 현장 사진(`photos`)이 즉시 프리필(Pre-fill)되어 작업 효율 극대화.
*   **플레이스홀더 및 규격 (Verbatim)**:
    *   방문 주소 `placeholder="전국 시공 주소 입력"`, 참고 사항 `placeholder="시공 시 주의사항 등 입력"`.
    *   시공 일시는 미래 예약을 위해 **과거 시점 선택 불가** (`limitType="past"`: Disable Past).
    *   공통 `h="45px"`, `borderRadius="10px"` 준수.

### 1.2 타임라인 카드 UI (Timeline Representation)
*   **헤더**: '시공 확정' 배지(**Color: `green`**), 시공 일시, 작성자 성명.
*   **정보 리스트**:
    *   **장소**: `장소 :  {location}` (TimelineCard.tsx 기준 라벨: "장소", Schedule 타입 특화)
    *   **전화**: `전화 :  000-0000-0000` (포맷팅 적용)
    *   **상품**: 원형 숫자 순번과 수량(`×`)이 포함된 텍스트.
    *   **물품**: 원형 숫자 순번과 수량(`×`)이 포함된 텍스트.
    *   **업무**: '시공 전', '시공 후' 배지(`gray.100`, `fontSize: 10px`)가 적용된 태스크 리스트 하단 노출.
*   **참고 사항**: 고유의 그레이 메모 박스(`gray.50`) 및 제목 '· 참고사항'과 함께 노출.

---

## 2. 기능 및 비즈니스 로직 (Functionality & Logic)

### 2.1 자재 산출 및 통합 통합 엔진 (Merging v124.77)
*   **구성 해석 (Regex)**: 상품의 `composition` 정보를 다음 정규식들로 정밀 추출.
    *   `/(.+)\s*[×x*]\s*(\d+)/`, `/(.+)\s*\((\d+)\)/`, `/(.+)\s*(\d+)개/`
    *   추출 시 `replace(/^[①-⑳]|^(\d+\.)/, "")`를 통해 인덱스 기호 강제 소거.
*   **지능형 합산 (LinkedId)**: 동일 자재가 복수 상품에서 요구될 경우 `linkedId`(CSV)를 통해 항목 통합 및 한 번에 차감.
*   **실시간 동적 싱크 (Simple Sum)**: 상위 상품 수량 변경 시 하위 `isAuto` 자재 수량은 **단순 1:1 합산**으로 동기화됨 (Parsing Ratio 무시).

### 2.2 자원 관리 및 데이터 계승 (Integration)
*   **데이터 계승 (Inheritance)**: 
    *   장소(`location`), 전화(`phone`), 담당자(`manager`)는 '시연 확정'(`demo_schedule`) 문서 혹은 고객 기본 정보에서 상속.
    *   사진(`photos`)은 '시연 완료'(`demo_complete`) 문서에서 상속.
*   **재고 실시간 동기화**: `runTransaction` 내에서 `aggregatedSuppliesMap`을 통한 원자적 차감 및 `assets` 로그 생성.
*   **삭제 복구**: 보고서 삭제 시 종속된 모든 사진 물리 소거 및 재고 기록 `delete_recovery`.

### 2.3 필수 입력 및 검증 (Form Validation)
*   **상품 선택 필수**: 시공할 상품이 최소 1개 이상 선택되어야 저장이 가능함.
*   **공통 필수**: 시공 일시, 담당자, 방문 주소, 연락처.

---

## 3. 시각 브랜드 세부 표준 (Visual Brand Standards)
*   **콜론 규격 (Verbatim Spacing)**: 모든 라벨의 콜론은 반드시 **'전 1칸, 후 2칸'** 공백 규격(` :  `)을 준수함.
*   **ThinParen 적용**: 수량(`×`), 괄호(`()`), 하이픈(`-`), 슬래시(`/`) 등 보조 기호는 `ThinParen` 적용.
*   **날짜 표기**: 연-월-일과 시:분 사이에 **2칸 공백** 사용. (`YYYY-MM-DD  HH:mm`)

---

## 4. 버전 기록 (Version History)

| 버전 | 날짜 | 변경 사항 |
|:---|:---|:---|
| v1.0 | 2026-02-03 | 시공 확정 기획서 초안 작성 |
| v1.1 | 2026-02-03 | TimelineCard 상세 노출 필드(장소/업무) 및 업무 지시서 초기값 반영 |
| v1.2 | 2026-02-03 | 자재 구성 파싱 Regex 정규식 및 데이터 계층 상속 지침 명문화 |

---
> [!NOTE]
> 본 문서는 '시공 확정' 모듈의 핵심 기준입니다. 특히 자재 통합 로직과 재고 차감의 무결성을 위해 본 설계를 최우선으로 준수합니다.
