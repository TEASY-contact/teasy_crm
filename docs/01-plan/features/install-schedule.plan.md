# 시공 확정 (Install Schedule) 기획서

시공 확정 양식은 실제 제품 설치를 위한 **'현장 투입 및 자재 운영'**을 설계하는 도구입니다. 시공될 상품에 필요한 각종 부자재를 자동으로 산출하고, 재고 시스템과 실시간으로 연동되어 오차 없는 시공 준비를 지원합니다.

---

## 1. 시각 표준 및 UI/UX (Visual & UX Engineering)

### 1.1 모달 디자인 및 UI 물리학 (Physics & Modals)
*   **사일런트 포커스 가드 (Focus Guard)**: 모달 진입 시 브라우저가 첫 번째 입력 필드에 강제 포커스를 두어 키보드를 팝업시키는 현상을 방지하기 위해, 투명한 더미 요소에 초기 포커스를 가두는 시스템 적용.
*   **UI 페인트 딜레이 (Paint Guard)**: 재고 연산 트랜잭션 전 UI가 "처리 중..." 상태를 렌더링할 수 있도록 **100ms의 인위적 페인트 시간**을 확보한 후 로직 수행.
*   **마이크로 리프팅 (Tactile Feedback)**: 버튼 호버 시 `cubic-bezier` 곡선을 따라 **`translateY(-1px)`** 부상하며, 클릭 시 **`scale(0.97)`**로 축소되는 물리 효과 적용.
*   **지능형 리스트 UI (List Standard)**:
    *   **상속 데이터 잠금 (Immutable Lock)**: `isInherited: true` 플래그가 주입된 항목은 삭제/수정 버튼이 UI에서 강제 차단됨. 직접 추가한 항목만 수정 가능.
    *   **자재 구분선**: 자동산출 자재와 수동 추가 항목 사이에 `purple.200` 색상의 **Dashed Divider** 배치.

### 1.2 입력기 인텔리전스 (Input Intelligence)
*   **Smart Auto-Zero (Shift-Zero)**: 월/일 입력 시 '2' 등 단일 숫자 입력 시 '02' 패딩과 동시에 다음 슬롯으로 커서가 즉시 점프.
*   **Forward Delete 엔진**: 구분 기호(`-`, `:`)를 건너뛰며 다음 숫자 슬롯을 소멸시키는 슬롯 기반 삭제 로직.
*   **Hard-Range Validation**: 24시간/31일 범위를 초과하는 입력 시 해당 슬롯을 즉시 공백으로 초기화.

---

## 2. 기능 및 비즈니스 로직 (Functionality & Logic)

### 2.1 자재 산출 및 통합 인텔리전스 (v126.3)
*   **5단계 복합 파싱 (Complex Regex)**: 상품 구성 정보를 해석할 때 `×`, `x`, `*`, `()`, `개` 등 5가지 주요 표기법을 모두 수용하는 복합 Regex 엔진 구동.
*   **지능형 자재 병합 (linkedId CSV)**: 복수 상품에서 동일 자재 요구 시 리스트를 중복하지 않고 수량을 합산하며, `linkedId` 필드에 연결된 모든 상품 ID를 CSV 형태로 트래킹.
*   **자동 마킹 시스템**: 산출된 자재에 `isAuto: true` 플래그를 영구 주입하여 관리 기준으로 활용.

### 2.2 자원 관리 및 데이터 통합 (Integration)
*   **신규 문서 ID 선할당 (Pre-allocation)**: 트랜잭션 충돌 방지를 위해 `runTransaction` 블록 외부에서 `activities` 문서 ID를 미리 생성하여 할당.
*   **메타 기록 동기화**: 활동 생성 시 해당 고객의 `customer_meta` 문서 내 **`totalCount`를 아토믹하게 증가**시켜 통계적 일관성 확보.
*   **안전한 다운로드 브릿지**: `fetch`의 `no-cache` 모드로 데이터를 확보한 후 `Blob` 객체를 통해 다운로드를 수행하여 데이터 구식화 방지.
*   **세션 스로틀링**: 다중 파일 다운로드 시 브라우저 보안 정책 우회를 위해 파일당 **200ms의 인위적 지연** 발생.

---

## 3. 타임라인 표현 표준 (Timeline Identity)

*   **조판 리듬 (Visual Rhythm)**: 콜론 전후에는 반드시 **비보관 공백(`\u00A0`)**을 배치하여 줄바꿈 시 콜론이 고립되는 현상 방지. (`\u00A0:\u00A0\u00A0`)
*   **브랜드 케이스**: 텍스트 내 'crm' 발견 시 렌더링 시점에 **대문자 'CRM'**으로 자동 교정.
*   **원형 숫자 조판 표준**: 유니코드 `①`~`⑳`을 사용하되, 항목이 **단 1개일 경우 번호를 자동 스트리핑**하여 시각적 과잉 방지.
*   **날짜 표기**: 연-월-일과 시간 사이에 **2칸 공백** 사용. (`YYYY-MM-DD  HH:mm`)

---

## 4. 버전 기록 (Version History)

| 버전 | 날짜 | 변경 사항 |
|:---|:---|:---|
| v2.0 | 2026-02-04 | 126건 최종 팩트 체크 반영. 5단계 복합 Regex, 상속 데이터 잠금, 지능형 자재 병합 사양 통합 |
| v3.0 | 2026-02-04 | 10차 정밀 감사 반영. 포커스 가드, 100ms 페인트 딜레이, ID 선할당, \u00A0 콜론 조판 및 물리 효과 사양 통합 |

---
> [!NOTE]
> 본 문서는 '시공 확정' 모듈의 구현 기준점입니다. 특히 100ms 페인트 딜레이와 ID 선할당, \u00A0 기반의 콜론 조판 표준은 시스템 무결성을 위한 핵심 규격이므로 철저히 준수해야 합니다.
