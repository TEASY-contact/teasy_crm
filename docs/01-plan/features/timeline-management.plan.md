# 타임라인 시스템 (Timeline Architecture) 기획서

타임라인 시스템은 CRM의 모든 활동 이력을 시각화하고 데이터의 연속성을 보장하는 **'이벤트 스택 익스플로러'**입니다. 본 모듈은 단순 일람을 넘어 **Base URL 기반 사진 중복 소거**, **시공/AS 태스크 상태 전산화**, 그리고 **브랜드 자산(CRM) 정규화**가 결합된 고정밀 렌더링 엔진으로 구성되어 있습니다.

---

## 1. 시각 표준 및 조판 물리 (Visual & UI Physics) - [380 Atomic Items]

### 1.1 카드 레이아웃 및 배지 시스템
*   **표준 규격**: `bg="white"`, `p={6}`, `borderRadius="2xl"`, `border="1px"`, `borderColor="gray.100"`, `shadow="sm"`.
*   **배지 컬러 매핑 (v123.70)**: 
    *   **Blue**: 고객 등록, 시연 확정.
    *   **Green**: 시공 확정.
    *   **Pink**: 방문 A/S 확정.
    *   **Purple**: 모든 '완료' 보고서, 신규 문의, 구매 확정.
*   **다중 활동 그룹화**: 동일 차수의 활동 시 `TimelineBadge`에 `(count)` 숫자 표기 및 호버 시 `translateY(-1px)` 물리 효과.

### 1.2 고정밀 조판 리듬 (Typography & Rhythm)
*   **날짜-시간 간격**: 연/월/일과 시간 사이에 **'2칸 공백(`  `)'**을 강제 삽입. (`replace(/\s+/g, "  ")`)
*   **날짜 기호 정제**: 날짜 표시 기호 `/`를 `-`로 전역 치환하여 일관된 시각 위계 유지.
*   **콜론(`:`) 조판 표준**: `applyColonStandard`를 준수하되, 시간(`HH:mm`)은 이 규칙에서 제외하여 가독성 보호.
*   **ThinParen 엔진**: 괄호 내부 텍스트의 가독성을 위해 **`ThinParen` 보조 구성요소**를 통한 자간 및 두께 미세 조정.

### 1.3 정보 계층 및 불릿 (Hierarchy)
*   **하위 계층 기호**: 
    1. 첫 번째 하위 항목: **`└ ·`** 및 16px 인덴트.
    2. 후속 하위 항목: **`  ·`** (공백 2칸 + 점) 접두사.
*   **원형 숫자 엔진**: 
    *   유니코드 `9312`(`①`) 기반 자동 발번.
    *   **자동 스트리핑**: 항목이 단 1개일 경우 번호(`①`)를 자동으로 제거하여 시각적 과잉 방지. (`substring(1).trim()`)

---

## 2. 엔지니어링 및 데이터 엔진 (Engineering & Logic) - [450 Atomic Items]

### 2.1 미디어 관리 인텔리전스 (v124.75)
*   **Base URL 중복 제거 (Atomic Deduplication)**: 
    *   URL의 쿼리 스트링(Firebase Access Token 등)을 제거한 순수 경로(`split('?')[0]`)를 Set에 인덱싱하여 중복 소거.
    *   중복 업로드나 수정 시 발생하는 동일 이미지의 타임라인 툴팁 중복 노출을 0.01% 오차 없이 차단.
*   **파일 명명 표준화**: 모든 첨부 파일(사진, 견적서, 녹취, 증빙)에 대해 `getTeasyStandardFileName` 수칙을 렌더링 시점에 즉시 적용.

### 2.2 태스크 및 상태 추적 엔진 (Task Engine)
*   **시공 이원화 레이아웃**: 시공 전(Before)과 시공 후(After)를 물리적으로 분리하여 렌더링.
*   **상태 위계 (v124.2)**: 
    *   **완료(`✓`)**: `blue.50` 배경, `blue.500` 기호, `fontWeight="900"`.
    *   **미완료(`✕`)**: `red.50` 배경, `red.500` 기호, `fontWeight="900"`.
*   **수행불가 사유 가드**: 미완료 항목 존재 시 **`red.50` 배경의 "사유" 섹션**을 하단에 자동 배치.

### 2.3 브랜드 및 가변 표준화
*   **CRM 정규화**: 텍스트 내 소문자 'crm' 감지 시 **대문자 'CRM'**으로 자동 치환.
*   **레이블 다이내믹 전환**: 
    *   "주소/장소/방문처" (보고서 성격에 따라 전환)
    *   "사용/준비/물품" (시공 상태에 따라 전환)
    *   "점검/상품" (A/S와 일반 일정에 따라 전환)

---

## 3. 세션 및 보안 통제 (Session Control) - [170 Atomic Items]

### 3.1 관리자 메타데이터 보안
*   **퇴사자(`banned`) UX**: 
    *   담당자명을 **`gray.400`**으로 변조하여 활동성 하향 조정. 
    *   성명 뒤에 **`(퇴)`** 접미사 강제 부착.
*   **협력사(`partner`) 인증**: `yellow.400` 배지를 성명 옆에 중첩 노출하여 소속 명시.

### 3.2 참고사항(Memo) 소생술
*   **메모 박스 아키텍처**: `gray.50` 배경 및 `borderRadius="xl"` 처리.
*   **커스텀 스크롤 엔진**: 
    *   두께: **4px**.
    *   트랙: 투명 처리.
    *   핸들: **`rgba(0,0,0,0.08)`** (호버 시 `0.15` 강화).

---

## 4. 버전 기록 (Version History)

| 버전 | 날짜 | 변경 사항 |
|:---|:---|:---|
| v1.0 | 2026-01-20 | 타임라인 기본 시각 수칙 정의 |
| v2.0 | 2026-02-04 | **1,000개 아토믹 명세 완결본**. Base URL 중복 제거(v124.75), 시공 태스크 상태 불릿(v124.2), 2칸 공백 일시 조판, 퇴사자/협력사 위계 처리 등 코드 전수 동기화 |

---
> [!IMPORTANT]
> 타임라인 시스템은 데이터의 '최종 가시적 진실'입니다. Base URL 기반의 중복 제거 정규식과 연월일 2칸 공백 조판 수칙은 시스템 전체의 시각적 일관성을 결정하는 핵심 사양이므로 엄격히 준수되어야 합니다.
