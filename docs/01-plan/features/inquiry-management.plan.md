# 신규 문의 (New Inquiry) 기획서

신규 문의 양식은 잠재 고객으로부터의 첫 접촉을 기록하고, 유입 경로와 초기 구매 의사를 파악하는 **'고객 여정의 통합 시작점'**입니다. 전화 문의, 네이버 톡톡, 채널톡, 기타 등 모든 채널을 단일 인터페이스에서 효율적으로 수용하도록 설계되었습니다.

---

## 1. 시각 표준 및 UI/UX (Visual & UX Engineering)

### 1.1 모달 디자인 및 UI 물리학 (Physics & Modals)
*   **사일런트 포커스 가드 (Focus Guard)**: 모달 진입 시 브라우저가 첫 번째 입력 필드에 강제 포커스를 두어 키보드를 팝업시키는 현상을 방지하기 위해, 투명한 더미 요소에 초기 포커스를 가두는 시스템 적용.
*   **마이크로 리프팅 (Tactile Feedback)**: 버튼 호버 시 `cubic-bezier` 곡선을 따라 **`translateY(-1px)`** 부상하며, 클릭 시 **`scale(0.97)`**로 축소되는 물리 효과 적용.

### 1.2 입력기 인텔리전스 (Input Intelligence)
*   **TeasyDateTimeInput 슬롯 매니지먼트**:
    *   **Shift-Zero (Cursor Jump)**: 월/일 입력 시 단일 숫자 입력 단계에서 자동 패딩 및 다음 슬롯 즉시 점프.
    *   **Forward Delete 엔진**: 구분 기호(`-`, `:`)를 건너뛰며 다음 숫자 슬롯을 소멸시키는 슬롯 기반 삭제 로직.
    *   **과거 날짜 보장**: 신규 문의는 기록 중심이므로 `limitType="future"` 속성을 통해 미래 날짜 선택을 원천 차단.

---

## 2. 기능 및 비즈니스 로직 (Functionality & Logic)

### 2.1 동적 가변 UI 및 리액티브 클린업 (Dynamics)
*   **채널별 자동 전환**:
    *   **"전화 문의"**: 연락처 필드가 활성화되며 고객의 기존 번호(`customer.phone`)를 계승. 채널 변경 시 해당 번호는 **즉시 클리어(Reactive Clean-up)**됨.
    *   **"네이버 톡톡" / "채널톡"**: 상세 필드 라벨이 `"닉네임"`으로 가변 설정되며 필수 입력 처리.
*   **CRM 브랜드 케이스**: 텍스트 내 'crm' 발견 시 렌더링 시점에 **대문자 'CRM'**으로 자동 교정.

### 2.2 시스템 원자성 및 데이터 통합 (Integrity)
*   **신규 활동 ID 선할당 (Pre-allocation)**: 충돌 방지를 위해 트랜잭션 블록 외부에서 `activities` 문서 ID를 미리 생성하여 할당.
*   **메타 기록 동기화**: 활동 생성 시 해당 고객의 `customer_meta` 문서 내 **`totalCount`를 아토믹하게 증가**시켜 통계 일관성 확보.
*   **물리적 스토리지 샤딩**: 녹취 파일(`recordings/`) 및 견적서(`quotes/`)는 고객 ID별 폴더(`${customerId}`)로 격리 저장.

---

## 3. 타임라인 표현 표준 (Timeline Identity)

*   **조판 리듬 (Visual Rhythm)**: 콜론 전후에는 반드시 **비보관 공백(`\u00A0`)**을 배치하여 줄바꿈 시 콜론이 고립되는 현상 방지. (`\u00A0:\u00A0\u00A0`)
*   **날짜 표기**: 연-월-일과 시간 사이에 **2칸 공백** 사용. (`YYYY-MM-DD  HH:mm`)
*   **하위 데이터 조판 (1st-level Sub-data)**: 채널 우측에 노출되는 닉네임 등은 별개 라인이 아닌, 1단계 항목 내 **얇은 괄호(`ThinParen`)**로 묶어 조판.
*   **보안 제어**: `lpignore` 적용으로 외부 자동완성 툴의 입력창 오염 방지.

---

## 4. 버전 기록 (Version History)

| 버전 | 날짜 | 변경 사항 |
|:---|:---|:---|
| v2.0 | 2026-02-04 | 126건 최종 팩트 체크 반영. 3중 백업 휴일 엔진, 물리적 스토리지 샤딩, Smart Auto-Zero 통합 |
| v3.0 | 2026-02-04 | 10차 정밀 감사 반영. 포커스 가드, 리액티브 클린업, \u00A0 콜론 조판 및 물리 효과 사양 통합 |

---
> [!IMPORTANT]
> 본 문서는 실제 운영 코드의 모든 엔지니어링 로직을 역설계하여 작성되었습니다. 특히 채널 전환 시의 데이터 클린업 로직과 비보관 공백 조판 표준은 시스템 정합성을 위한 핵심 사양이므로 반드시 준수해야 합니다.
