# 구매 확정 (Purchase Confirm) 기획서

구매 확정 양식은 영업의 최종 결실인 **'매출 확정 및 납품 준비'**를 기록하는 가장 중요한 문서입니다. 결제 방식에 따른 증빙 관리와 납품할 제품군을 정밀하게 정의하도록 설계되었습니다.

---

## 1. 시각 표준 및 UI/UX (Visual & UX Engineering)

### 1.1 모달 디자인 및 UI 물리학 (Physics & Modals)
*   **사일런트 포커스 가드 (Focus Guard)**: 모달 진입 시 브라우저가 첫 번째 입력 필드에 강제 포커스를 두어 키보드를 팝업시키는 현상을 방지하기 위해, 투명한 더미 요소에 초기 포커스를 가두는 시스템 적용.
*   **마이크로 리프팅 (Tactile Feedback)**: 버튼 및 인터랙티브 요소 호버 시 `cubic-bezier` 곡선을 따라 **`translateY(-1px)`** 부상하며, 클릭 시 **`scale(0.97)`**로 축소되는 물리 효과 적용.
*   **드래그 앤 드롭 인텔리전스**: 상품 리스트 순서 변경 시 `scale: 1.02` 피드백과 함께 그림자 농도가 동적으로 변화하여 시각적 깊이감 제공.

### 1.2 입력기 및 데이터 정규화 (Data Dynamics)
*   **TeasyDateTimeInput 슬롯 매니지먼트**:
    *   **Shift-Zero (Cursor Jump)**: 월/일 입력 시 단일 숫자 입력 단계에서 자동 패딩 및 다음 슬롯 즉시 점프.
    *   **Forward Delete 엔진**: 구분 기호(`-`, `:`)를 건너뛰며 다음 숫자 슬롯을 소멸시키는 슬롯 기반 삭제 로직.
*   **ID 및 파일명 정밀 정제**:
    *   **8종 공백 정규화**: ID 필드와 증빙 파일명에서 모든 투명/유니코드 공백(`\u00A0`, `\u1680` 등)을 감지하여 **언더바(`_`)**로 강제 치환.
    *   **확장자 스트리핑**: 증빙 파일명 표시 시 `lastIndexOf('.')` 기반으로 확장자를 제거하여 순수 이름만 노출.

---

## 2. 기능 및 비즈니스 로직 (Functionality & Logic)

### 2.1 자가 치유 및 원자적 트랜잭션 (Integrity)
*   **데이터 자가 치유 엔진 (Self-Healing)**: 트랜잭션 완료 후 백그라운드에서 `performSelfHealing`을 호출. 전체 로그를 시간순으로 재배열하여 마스터 재고(`asset_meta`)와 0.01%의 오차도 없이 동기화.
*   **보유자산 가나다 정렬**: 고객 마스터의 `ownedProducts` 갱신 시 상품명을 가나다 순으로 자동 정렬하여 관리 효율 극대화.
*   **원자적 트랜잭션**: [재고 차감 → Assets 로그 생성 → 고객 보유자산 갱신 → 순번 발행]이 단일 사이클로 수행됨.

### 2.2 자원 관리 및 보안 통제 (Integration)
*   **수정 기한의 기준점**: 3영업일 카운트다운은 유저가 선택한 일시가 아닌, **문서가 실제로 DB에 생성된 시점(`createdAt`)**을 기준으로 계산.
*   **안전한 다운로드 브릿지**: `fetch`의 `no-cache` 모드로 데이터를 확보한 후 `Blob` 객체를 통해 다운로드를 수행하여 데이터 구식화 방지.
*   **세션 스로틀링**: 다중 파일 다운로드 시 브라우저 보안 정책 우회를 위해 파일당 **200ms의 인위적 지연** 발생.

---

## 3. 타임라인 표현 표준 (Timeline Identity)

*   **배송 정보 계층 구조**: 주요 정보(날짜/주소)를 최상단에 두고, 업체(Courier)와 송장(Tracking)을 하위 계층(`└ ·`)으로 분리하여 가독성 증대.
*   **조판 리듬 (Visual Rhythm)**: 콜론 전후에는 **비보관 공백(`\u00A0`)**을 배치하여 줄바꿈 시 콜론 고립 방지. (`\u00A0:\u00A0\u00A0`)
*   **브랜드 케이스 및 조판**: 텍스트 내 'crm' 발견 시 렌더링 시점에 **대문자 'CRM'**으로 자동 교정. 일시 표시 시 날짜/시간 사이 **'2칸 공백'** 적용.

---

## 4. 버전 기록 (Version History)

| 버전 | 날짜 | 변경 사항 |
|:---|:---|:---|
| v2.0 | 2026-02-04 | 126건 최종 팩트 체크 반영. 자가 치유 엔진, 보유자산 자동 정렬, ID 공백 정적 치환 통합 |
| v3.0 | 2026-02-04 | 10차 정밀 감사 반영. 포커스 가드, \u00A0 콜론 조판, 8종 공백 정규화 및 물리 효과 사양 통합 |

---
> [!IMPORTANT]
> 본 문서는 '구매 확정' 모듈의 구현 기준점입니다. 자가 치유 엔진을 통한 데이터 무결성 확보와 비보관 공백 조판 표준은 시스템 신뢰성을 위한 핵심 규격이므로 철저히 준수해야 합니다.
